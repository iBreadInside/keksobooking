(()=>{"use strict";const e=e=>{const t=document.querySelector(`#${e}`).content.cloneNode(!0).querySelector(`.${e}`),r=t.querySelector(".error__button");document.body.append(t),document.addEventListener("keydown",(e=>{"27"!==e.key&&"Escape"!==e.key||t.remove(),document.removeEventListener("keydown",e)})),r&&r.addEventListener("click",(()=>{t.remove()})),t.addEventListener("click",(()=>{t.remove()}))},t=document.querySelector(".ad-form"),r=document.querySelector(".map__filters"),o=e=>{e.forEach((e=>e.disabled=!0))},a=e=>{e.forEach((e=>e.disabled=!1))},n=()=>{t.classList.contains("ad-form--disabled")?(t.classList.remove("ad-form--disabled"),a(t.querySelectorAll("fieldset"))):(t.classList.add("ad-form--disabled"),o(t.querySelectorAll("fieldset")))},c=(e,t,r)=>{const o=document.createElement(e);return o.classList.add(t),r&&(o.textContent=r),o},l=(e,t)=>{const r=(e=Math.abs(e)%100)%10;return e>10&&e<20?t[2]:r>1&&r<5?t[1]:1==r?t[0]:t[2]},s=["35.68000","139.76000"],d=[1e4,5e4],u=document.querySelector("#address"),i=document.querySelector(".map__filters"),p=i.querySelector("#housing-type"),f=i.querySelector("#housing-price"),y=i.querySelector("#housing-rooms"),m=i.querySelector("#housing-guests"),h=[...i.querySelector("#housing-features").querySelectorAll(".map__checkbox")],g=L.map("map-canvas").on("load",(()=>{n()})).setView({lat:s[0],lng:s[1]},10);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(g);const v=L.icon({iconUrl:"img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),S=L.marker({lat:s[0],lng:s[1]},{draggable:!0,icon:v});S.addTo(g),u.value=s;const q=L.layerGroup(),b=L.icon({iconUrl:"img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]}),k=(e,t)=>{const r=e.getLatLng();return Math.sqrt((r.lat-t.location.lat)**2+(r.lng-t.location.lng)**2)},x=(e,t)=>k(S,e)-k(S,t),E=e=>{q.clearLayers(),e.slice().sort(x).slice(0,10).forEach((e=>{var t,r;t=e,r=q,L.marker({lat:t.location.lat,lng:t.location.lng},{icon:b}).addTo(r).bindPopup((e=>{const t=document.querySelector("#card").content.cloneNode(!0).querySelector(".popup");switch(t.querySelector(".popup__avatar").src=e.author.avatar,t.querySelector(".popup__title").textContent=e.offer.title,t.querySelector(".popup__text--address").textContent=e.offer.address,t.querySelector(".popup__text--price").innerHTML=e.offer.price+" <span>₽/ночь</span>",e.offer.type){case"palace":t.querySelector(".popup__type").textContent="Дворец";break;case"flat":t.querySelector(".popup__type").textContent="Квартира";break;case"house":t.querySelector(".popup__type").textContent="Дом";break;case"bungalow":t.querySelector(".popup__type").textContent="Бунгало"}if(t.querySelector(".popup__text--capacity").textContent=`${e.offer.rooms} ${l(e.offer.rooms,["комната","комнаты","комнат"])} для ${e.offer.guests} ${l(e.offer.guests,["гостя","гостей","гостей"])}`,t.querySelector(".popup__text--time").textContent=`Заезд после ${e.offer.checkin}, выезд до ${e.offer.checkout}`,e.offer.features){t.querySelector(".popup__features").innerHTML="";for(let r=0;r<e.offer.features.length;r++){const o=c("li","popup__feature");o.classList.add(`popup__feature--${e.offer.features[r]}`),t.querySelector(".popup__features").appendChild(o)}}else t.querySelector(".popup__features").remove();if(e.offer.description?t.querySelector(".popup__description").textContent=e.offer.description:t.querySelector(".popup__description").remove(),e.offer.photos){t.querySelector(".popup__photos").innerHTML="";for(let r=0;r<e.offer.photos.length;r++){const o=c("img","popup__photo");o.src=e.offer.photos[r],o.width="45",o.height="40",o.alt="Фотография жилья",t.querySelector(".popup__photos").appendChild(o)}}else t.querySelector(".popup__photos").remove();return t})(t))})),q.addTo(g)},w=e=>e.filter((e=>{return(e.offer.type===p.value||"any"===p.value)&&(t=e,"middle"===f.value&&d[0]<=t.offer.price&&t.offer.price<=d[1]||"low"===f.value&&t.offer.price<d[0]||"high"===f.value&&t.offer.price>d[1]||"any"===f.value)&&(e=>e.offer.rooms===Number(y.value)||"any"===y.value)(e)&&(e=>e.offer.guests===Number(m.value)||"any"===m.value)(e)&&(e=>{const t=h.filter((e=>e.checked)).map((e=>e.value));return r=e.offer.features,t.every((e=>r.includes(e)))||0===t.length;var r})(e);var t})),C=["0","1000","5000","10000"],A=["gif","jpg","jpeg","png"],$=document.querySelector(".ad-form"),T=$.querySelector("#avatar"),I=$.querySelector(".ad-form-header__preview").querySelector("img"),z=$.querySelector("#type"),M=$.querySelector("#price"),j=$.querySelector("#timein"),D=$.querySelector("#timeout"),F=$.querySelector("#room_number"),R=$.querySelector("#capacity").querySelectorAll("option"),N=$.querySelector(".ad-form__reset"),U=$.querySelector("#images"),H=$.querySelector(".ad-form__photo"),P=(e,t)=>{e?((e=>{e.disabled=!1})(t),(e=>{e.selected=!0})(t)):((e=>{e.selected=!1})(t),(e=>{e.disabled=!0})(t))},O=()=>{$.reset(),u.value=s,S.setLatLng(s)};var W;$.addEventListener("submit",(t=>{var r,o,a;t.preventDefault(),r=new FormData(t.target),o=t=>{O(),e(t)},a=t=>{e(t)},fetch("https://22.javascript.pages.academy/keksobooking",{method:"POST",body:r}).then((e=>{e.ok?o("success"):a("error")})).catch((()=>{a("error")}))})),N.addEventListener("click",(e=>{e.preventDefault(),O()})),T.addEventListener("change",(()=>{const e=T.files[0],t=e.name.toLowerCase();if(A.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{I.src=t.result})),t.readAsDataURL(e)}})),U.addEventListener("change",(()=>{const e=U.files[0],t=e.name.toLowerCase();if(A.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{H.style.backgroundSize="contain",H.style.backgroundPosition="center",H.style.backgroundRepeat="no-repeat",H.style.backgroundImage=`url('${t.result}')`})),t.readAsDataURL(e)}})),n(),r.classList.add("map__filters--disabled"),o(r.querySelectorAll("select")),o(r.querySelectorAll("fieldset")),R.forEach((e=>{"0"===e.value&&(e.disabled=!0)})),z.addEventListener("change",(()=>{M.min=C[z.selectedIndex],M.placeholder=C[z.selectedIndex]})),j.addEventListener("change",(()=>{D.selectedIndex=j.selectedIndex})),D.addEventListener("change",(()=>{j.selectedIndex=D.selectedIndex})),F.addEventListener("change",(()=>{switch(F.value){case"1":R.forEach((e=>{P("1"===e.value,e)}));break;case"2":R.forEach((e=>{P(["1","2"].includes(e.value),e)}));break;case"3":R.forEach((e=>{P(["1","2","3"].includes(e.value),e)}));break;default:R.forEach((e=>{P("0"===e.value,e)}))}})),W=e=>{r.classList.contains("map__filters--disabled")&&(r.classList.remove("map__filters--disabled"),a(r.querySelectorAll("select")),a(r.querySelectorAll("fieldset"))),E(e),(e=>{i.addEventListener("change",_.debounce((()=>{q.clearLayers(),E(w(e))}),500))})(e),(e=>{S.on("moveend",(t=>{q.clearLayers(),u.value=(e=>{const t=e.getLatLng();return[t.lat.toFixed(5),t.lng.toFixed(5)]})(t.target),E(w(e))}))})(e)},fetch("https://22.javascript.pages.academy/keksobooking/data").then((e=>e.json())).then((e=>{W(e)})).catch((()=>{(e=>{const t=document.createElement("div");t.style.zIndex=100,t.style.position="absolute",t.style.left=0,t.style.top=0,t.style.right=0,t.style.padding="10px 3px",t.style.fontSize="30px",t.style.textAlign="center",t.style.backgroundColor="red",t.textContent="Не удалось загрузить объявления. Пожалуйста, обновите страницу",document.body.append(t),setTimeout((()=>{t.remove()}),3e3)})()}))})();
//# sourceMappingURL=main.bundle.js.map